# Tests for g-code G10/G11 firmware retraction commands
DICTIONARY atmega2560.dict
CONFIG firmware_retraction.cfg

G28
G1 X20 Y20 Z20

SET_RETRACTION RETRACT_LENGTH=2.5 UNRETRACT_EXTRA_LENGTH=1.0 LIFT_Z=0.0
G11
VERIFY_AXIS_POSITION AXIS=e EXPECTED=0.0

G10
VERIFY_AXIS_POSITION AXIS=e EXPECTED=-2.5

G10
VERIFY_AXIS_POSITION AXIS=e EXPECTED=-2.5

G11
VERIFY_AXIS_POSITION AXIS=e EXPECTED=1.0

# test basic lift z
SET_RETRACTION UNRETRACT_EXTRA_LENGTH=0.0 LIFT_Z=0.4

G10
VERIFY_AXIS_POSITION AXIS=z EXPECTED=20.4

G10
VERIFY_AXIS_POSITION AXIS=z EXPECTED=20.4

G11
VERIFY_AXIS_POSITION AXIS=z EXPECTED=20.0

# change lift z distance while lifted
G10
SET_RETRACTION LIFT_Z=0.8

G11
VERIFY_AXIS_POSITION AXIS=z EXPECTED=20.4
VERIFY_AXIS_POSITION AXIS=e EXPECTED=-1.5


# move z while z is lifted
SET_RETRACTION LIFT_Z=0.4
G10
G1 Z25

G11
VERIFY_AXIS_POSITION AXIS=z EXPECTED=25.0
VERIFY_AXIS_POSITION AXIS=e EXPECTED=-1.5

# move xy while z is lifted
G1 Z20
G10
G1 X10 Y15
VERIFY_AXIS_POSITION AXIS=z EXPECTED=20.4

G11
VERIFY_AXIS_POSITION AXIS=z EXPECTED=20.0
